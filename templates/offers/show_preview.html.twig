{% extends 'base-company.html.twig' %}

{% block title %} {{ parent() }} - students {% endblock %}

{% block body %}
    <h1>Offers</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ offers.id }}</td>
            </tr>
            <tr>
                <th>Title</th>
                <td>{{ offers.title }}</td>
            </tr>
            <tr>
                <th>Location</th>
                <td>{{ offers.location }}</td>
            </tr>
            <tr>
                <th>Domain</th>
                <td>{{ offers.domain }}</td>
            </tr>
            <tr>
                <th>DateStart</th>
                <td>{{ offers.dateStart ? offers.dateStart|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>DateEnd</th>
                <td>{{ offers.dateEnd ? offers.dateEnd|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ offers.description }}</td>
            </tr>
        </tbody>
    </table>

    {% if applies is defined %}

    <h1>Appliants</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Location</th>
                <th>Profile</th>
                <th>Action</th>
            </tr>

    {% for applies in applies %}
            
            <tr>
                <td>{{ applies.student.id }}</td>
                <td>{{ applies.student.name }}</td>
                <td>{{ applies.student.lastname }}</td>
                <td><a href="{{ path('show_applied_profile', { "id":applies.student.id, "company_id": offers.company.id }) }}">show</a></td>
                <td class='btn btn-group' style="color:white;">

                {% if applies.hired == false and applies.confirmed == false %}

                    <form method="post" action="{{ path('hire', { id:applies.id }) }}">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ offers.id) }}">
                        <button class="btn btn-success">Embaucher</button>
                    </form>

                {% elseif applies.hired == true and applies.confirmed == false  %}

                    <form method="post" action="{{ path('confirm', { id:applies.id }) }}">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ offers.id) }}">
                        <button class="btn btn-success">Confirmer</button>
                    </form>

                {% elseif applies.hired == false and applies.confirmed == true %}
                    
                <a class="btn btn-success">Confirmed !</a>
                <form method="post" action="{{ path('apply_delete', {'id': applies.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                    <input type="hidden" name="_method" value="DELETE">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ applies.id) }}">
                    <button class="btn btn-danger">Delete</button>
                </form>

                {% endif %}

                {% if applies.confirmed == false %}
                    <form method="post" action="{{ path('apply_refuse', {'id': applies.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ applies.id) }}">
                        <button class="btn btn-danger">Refuse</button>
                    </form>
                {% endif %}
                </td>
            </tr>
        
    {% endfor %}

    </tbody>
</table>

    {% endif %}

    <a href="{{ path('offers_company_index', {id:offers.company.id}) }}" class="btn btn-secondary">back to list</a>

    <a href="{{ path('offers_edit', {'id': offers.id}) }}" class="btn btn-light">edit</a>

{% endblock %}
