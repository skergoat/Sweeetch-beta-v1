{% extends 'base-company.html.twig' %}

{% block title %} {{ parent() }} - students {% endblock %}

{% block body %}

<br><br>

<a href="{{ path('offers_company_index', {id:offers.company.id}) }}" class="btn btn-secondary">back to list</a>

<a href="{{ path('offers_edit', {'id': offers.id, 'company':company.id}) }}" class="btn btn-light">edit</a>

<br><br>

    <h3>Offers</h3>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ offers.id }}</td>
            </tr>
            <tr>
                <th>Title</th>
                <td>{{ offers.title }}</td>
            </tr>
            <tr>
                <th>Location</th>
                <td>{{ offers.location }}</td>
            </tr>
            <tr>
                <th>Domain</th>
                <td>{{ offers.domain }}</td>
            </tr>
            <tr>
                <th>DateStart</th>
                <td>{{ offers.dateStart ? offers.dateStart|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>DateEnd</th>
                <td>{{ offers.dateEnd ? offers.dateEnd|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ offers.description }}</td>
            </tr>
        </tbody>
    </table>

    <br> 

    {% if applies[0] is defined %}

        {% if applies[0].confirmed == false %}  
        <h3>Appliants</h3>
        {% else %}
        <h3>Hired</h3>
        {% endif %}

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Location</th>
                <th>Profile</th>
                <th>Action</th>
            </tr>

            {% for applies in applies %}
            
            <tr>
                <td>{{ applies.student.id }}</td>
                <td>{{ applies.student.name }}</td>
                <td>{{ applies.student.lastname }}</td>
                {% if is_granted('ROLE_ADMIN') %}
                <td><a href="{{ path('student_show', { "id":applies.student.id }) }}">show</a></td>
                {% else %}
                <td><a href="{{ path('show_applied_profile', { "id":applies.student.id, "company_id": offers.company.id }) }}">show</a></td>
                {% endif %}
                <td class='btn btn-group' style="color:white;">

                {% if applies.hired == false and applies.confirmed == false and applies.agree == false %}

                    <form method="post" action="{{ path('hire', { id:applies.id }) }}">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ offers.id) }}">
                        <button class="btn btn-success">Embaucher</button>
                    </form>

                    <form method="post" action="{{ path('apply_refuse', {'id': applies.id, 'from' : 'company'}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ applies.id) }}">
                        <button class="btn btn-danger">Remove</button>
                    </form>

                {% elseif applies.hired == true %}

                    <div style="color:red">En attente d'acceptation</div>

                {% elseif applies.agree == true %}

                <form method="post" action="{{ path('confirm', { id:applies.id }) }}">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ offers.id) }}">
                    <button class="btn btn-success">Confirmer</button>
                </form>

                {% elseif applies.confirmed == true %}

                <form method="post" action="{{ path('apply_finish', {'id': applies.id }) }}" onsubmit="return confirm('Are you sure you want to finish this mission ?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ applies.id) }}">
                    <button class="btn btn-warning">Finish</button>
                </form>

                {% endif %}

                </td>
            </tr>
        
        {% endfor %}

    </tbody>
</table>

    {% endif %}

{% if finished is not empty %}

    <h3>Finished</h3>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Location</th>
                <th>Profile</th>
            </tr>

        {% for finished in finished %} 
        
            {% if finished.student.id is defined %}

            <tr>
                <td>{{ finished.student.id }}</td>
                <td>{{ finished.student.name }}</td>
                <td>{{ finished.student.lastname }}</td>
                {% if is_granted('ROLE_ADMIN') %}
                <td><a href="{{ path('student_show', { "id":finished.student.id }) }}">show</a></td>
                {% else %}
                <td><a href="{{ path('show_applied_profile', { "id":finished.student.id, "company_id": offers.company.id }) }}">show</a></td>
                {% endif %}
            </tr>

            {% else %}

            <tr>
                <th style="color:red;">Student profile deleted</th>
                <th></th>
                <th></th>
                <th>
                    <form method="post" action="{{ path('delete_empty_companySide', {'id': offers.id }) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                        <input type="hidden" name="_method" value="DELETE">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ offers.id) }}">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </th>
            </tr>

            {% endif %}
            
        {% endfor %}

    </tbody>
</table>

    {% endif %}

{% endblock %}
