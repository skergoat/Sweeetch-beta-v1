{% extends 'base-company.html.twig' %}

{% block title %} {{ parent() }} - Entreprises {% endblock %}

{% block body %}

{% if is_granted('ROLE_SUPER_COMPANY') %}

<div id="flag-1" class="modal">
  <div class="container" style="text-align:justify;">

      <p>La <strong>Situation</strong> correspond √† l'√©tat du recrutement : </p>
      <ul style="list-style-type:none;display:flex;">
        <li style="margin-left:5px;"><span class="badge bg-primary">Ouvert</span></li>
        <li style="margin-left:5px;"><span class="badge bg-warning">En Attente</span></li>
        <li style="margin-left:5px;"><span class="badge bg-info">A Confirmer</span></li>
      </ul><br>
      <ul>
        <li><span class="badge bg-primary">Ouvert</span> Signifie que personne n'est encore recrut√© sur cette annonce et que les candidats peuvent postuler</li><br>
        <li><span class="badge bg-warning">En Attente</span> Signifie que vous avez recrut√© un candidat sur cette mission et qu'il doit maintenant accepter ou refuser</li><br>
        <li><span class="badge bg-info">A Confirmer</span> Signifie que l'√©l√®ve a accepet√© votre offre et que le temps de signer les contrats est maintenant venu !</li><br>
      </ul>

      <p>Une fois le recrutement confirm√©, l'annonce est immediatement marqu√©e comme "ferm√©e" et consultable dans l'onglet "Ferm√©es" de la barre lat√©rale</p><br>
      
      
      <p style="font-weight:900;">Bon Travail !</p>
      {# <h5>L'embauche se d√©roule en 5 √©tapes :</h5>
      <br>
      <ol>
          <li>L'√©tudiant postule √† votre offre</li><br>
          <li>Vous choisissez de l'embaucher en cliquant sur <button class="btn btn-success btn-sm"><i class="fas fa-user-check" title="Embaucher"></i> Recruter</button><br><br>
          <li>Vous voyez ensuite apparaitre le badge :  <span class="badge badge-warning right">En attente d'acceptation du candidat</span> pour laisser au candidat le temps d'accepter la mission</li><br>
          <li>Quand il a accept√©, vous pouvez prendre contact avec l'√©tudiant et commencer la proc√©dure d'embauche. </li><br>
          <li> Une fois le recrutement termin√©, cliquez sur  <button class="btn btn-info btn-sm"><i class="far fa-stop-circle"></i> Finaliser le recrutement</button> pour indiquer que la mission commence</li><br>
      </ol>
      <p><strong>Nb :</strong> si vous souhaitez refuser d√©finitivement une candidature, cliquez sur : <button class="btn btn-danger btn-sm"><i class="fas fa-times"></i> Refuser</button></p>
      <p><strong>Nb : Tous ces boutons apparaissent au fur et a mesure l'avanc√©e du recrutement. Si vous ne les trouvez pas tous en m√™me temps, c'est normal üòâ </strong></p> #}
  </div> 
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6">
            <h1 class="m-0">Annonces</h1> <br>
            <a href="{{ path('offers_new', {id:company.id}) }}" class="btn btn-success">Cr√©er une Annonce</a>
        </div>
    </div>
</div> <br>

{% for message in app.flashes('success') %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endfor %}

{% for message in app.flashes('error') %}
<div class="alert alert-danger">
    {{ message }}
</div>
{% endfor %}

<section class="content">
  <div class="row">
      <div class="col-12">
          <div class="card">
    
              <!-- /.card-header -->
              <div class="card-body">
                  <table id="example1" class="table table-bordered table-hover">
              <thead>
                  <tr>
                      <th>Titre</th>
                      <th>Lieu</th>
                      <th>D√©but</th>
                      <th>Situation 
                        <a href="#flag-1" rel="modal:open" class="badge " title="aide" style="color:#8e8e8e;">
                          <i class="fas fa-question-circle"></i>
                        </a>
                      </th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody>

              {% for offers in offers %}

                {% if offers.applies | length == 0 %} 
              
                  <tr>
                      <td><a href="{{ path('offers_preview', {'id': offers.id, 'company':company.id}) }}">{{ offers.title }}</a></td>
                      <td>{{ offers.location }}</td>
                      <td>{{ offers.dateStart ? offers.dateStart|date("d/m/Y √† g\\hi") : '' }}</td>
                      <td> <span class="badge bg-primary">Ouvert</span> </td>
                      <td>
                          <a href="{{ path('offers_edit', {'id': offers.id, 'company':company.id}) }}" title="Modifier" class="btn btn-danger btn-sm"> 
                            <i class="fas fa-times"></i>
                            Modifier
                          </a>
                      </td> 
                  </tr>
                  
                {% elseif offers.applies | length > 0 %}

                  {% if offers.applies[0].finished == false and offers.applies[0].confirmed == false %} 

                  <tr>
                      <td><a href="{{ path('offers_preview', {'id': offers.applies[0].offers.id, 'company':company.id}) }}">{{ offers.applies[0].offers.title }}</a></td>
                      <td>{{ offers.applies[0].offers.location }}</td>
                      <td>{{ offers.applies[0].offers.dateStart ? offers.applies[0].offers.dateStart|date("d/m/Y") : '' }}</td>
                      <td>    
                          {% if offers.applies[0].confirmed == false %}
                            {% if offers.applies[0].agree == false %}
                              {% if offers.applies[0].hired == false %}
                              <span class="badge bg-primary">Ouvert</span>
                              {% else %}
                              <span class="badge bg-warning">En attente</span>
                              {% endif %}
                            {% else %}
                              <span class="badge bg-info">A Finaliser</span>    
                            {% endif %}
                          {% else %}
                          <span class="badge bg-success">En cours</span>
                          {% endif %} 
                      </td>
                      <td>
                        <a href="{{ path('offers_edit', {'id': offers.applies[0].offers.id, 'company':company.id}) }}">
                          <button  title="Modifier" style="color:white;" class="btn btn-secondary btn-sm"> 
                            <i class="fas fa-edit"></i>
                            Modifier
                          </button>
                        </a>
                      </td>
                  </tr>

                 {# {% elseif offers.applies[0].finished == true and offers.applies | length == 0 %}
                  <tr class="border-top">
                    <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
                  </tr> 
                  {% elseif offers.applies[0].finished == true and offers.applies | length > 0 and offers | length == 0 %}
                  <tr class="border-top">
                    <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
                  </tr>  #}
                  {% endif %} 
              
              {# {% else %}
              <tr class="border-top">
                  <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
              </tr> #}
              {% endif %}
              
              {% endfor %}
              </tbody>
            </table>
          </div>
  <!-- /.card-body -->
      </div>
  <!-- /.card -->
  </div>
<!-- /.col -->
</div>
<!-- /.row -->
</section>
          {# </table>
      </div>

      <div class="pagination-bottom mt-5">{{ knp_pagination_render(offers) }}</div> 

  </div>      
</div> #}

{% else %}

<br><br>
<div class="col-12 col-sm-6 col-md-6">
    <div class="info-box mb-3 overflow-box">
      <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-hourglass-start"></i></span>

        <div class="info-box-nopage info-box-content">
            <span class="info-box-text">Votre compte doit √™tre valid√© pour cr√©er des annonces</span>            
        </div>
        
    </div>
</div> 

{% endif %}

{% endblock %}
