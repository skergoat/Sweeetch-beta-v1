{% extends 'base-company.html.twig' %}

{% block title %} {{ parent() }} - Entreprises {% endblock %}

{% block body %}

{% if is_granted('ROLE_SUPER_COMPANY') %}

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6">
            <h1 class="m-0">Annonces</h1> <br>
            <a href="{{ path('offers_new', {id:company.id}) }}" class="btn btn-success">Créer une Annonce</a>
        </div>
    </div>
</div> <br>

{% for message in app.flashes('success') %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endfor %}

{% for message in app.flashes('error') %}
<div class="alert alert-danger">
    {{ message }}
</div>
{% endfor %}

<section class="content">
  <div class="row">
      <div class="col-12">
          <div class="card">
    
              <!-- /.card-header -->
              <div class="card-body">
                  <table id="example1" class="table table-bordered table-hover">
              <thead>
                  <tr>
                      <th>Titre</th>
                      <th>Lieu</th>
                      <th>Début</th>
                      <th>Situation</th>
                      <th>Modifier</th>
                  </tr>
              </thead>
              <tbody>

              {% for offers in offers %}

                {% if offers.applies | length == 0 %} 
              
                  <tr>
                      <td><a href="{{ path('offers_preview', {'id': offers.id, 'company':company.id}) }}">{{ offers.title }}</a></td>
                      <td>{{ offers.location }}</td>
                      <td>{{ offers.dateStart ? offers.dateStart|date("d/m/Y à g\\hi") : '' }}</td>
                      <td> <span class="badge bg-primary">Ouvert</span> </td>
                      <td>
                          <a href="{{ path('offers_edit', {'id': offers.id, 'company':company.id}) }}" title="Modifier"><i class="fas fa-edit"></i></a>
                      </td> 
                  </tr>
                  
                {% elseif offers.applies | length > 0 %}

                  {% if offers.applies[0].finished == false and offers.applies[0].confirmed == false %} 

                  <tr>
                      <td><a href="{{ path('offers_preview', {'id': offers.applies[0].offers.id, 'company':company.id}) }}">{{ offers.applies[0].offers.title }}</a></td>
                      <td>{{ offers.applies[0].offers.location }}</td>
                      <td>{{ offers.applies[0].offers.dateStart ? offers.applies[0].offers.dateStart|date("d/m/Y") : '' }}</td>
                      <td>    
                          {% if offers.applies[0].confirmed == false %}
                            {% if offers.applies[0].agree == false %}
                              {% if offers.applies[0].hired == false %}
                              <span class="badge bg-primary">Ouvert</span>
                              {% else %}
                              <span class="badge bg-warning">En attente</span>
                              {% endif %}
                            {% else %}
                              <span class="badge bg-warning">A valider</span>    
                            {% endif %}
                          {% else %}
                          <span class="badge bg-success">En cours</span>
                          {% endif %} 
                      </td>
                      <td>
                          <a href="{{ path('offers_edit', {'id': offers.applies[0].offers.id, 'company':company.id}) }}" title="Modifier"><i class="fas fa-edit"></i></a>
                      </td>
                  </tr>

                 {# {% elseif offers.applies[0].finished == true and offers.applies | length == 0 %}
                  <tr class="border-top">
                    <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
                  </tr> 
                  {% elseif offers.applies[0].finished == true and offers.applies | length > 0 and offers | length == 0 %}
                  <tr class="border-top">
                    <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
                  </tr>  #}
                  {% endif %} 
              
              {# {% else %}
              <tr class="border-top">
                  <td colspan="8" class="border-top-td">Aucun emploi pour le moment</td>
              </tr> #}
              {% endif %}
              
              {% endfor %}
              </tbody>
            </table>
          </div>
  <!-- /.card-body -->
      </div>
  <!-- /.card -->
  </div>
<!-- /.col -->
</div>
<!-- /.row -->
</section>
          {# </table>
      </div>

      <div class="pagination-bottom mt-5">{{ knp_pagination_render(offers) }}</div> 

  </div>      
</div> #}

{% else %}

<br><br>
<div class="col-12 col-sm-6 col-md-6">
    <div class="info-box mb-3 overflow-box">
      <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-hourglass-start"></i></span>

        <div class="info-box-nopage info-box-content">
            <span class="info-box-text">Votre compte doit être validé pour créer des annonces</span>            
        </div>
        
    </div>
</div> 

{% endif %}

{% endblock %}
